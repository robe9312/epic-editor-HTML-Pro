<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor HTML Pro - Experiencia Illustrator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4f46e5;
            --secondary: #06b6d4;
            --dark: #0f172a;
            --light: #f8fafc;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --panel-bg: rgba(15, 23, 36, 0.95);
            --card-bg: rgba(30, 41, 59, 0.7);
            --border-color: rgba(255, 255, 255, 0.1);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            color: var(--light);
            min-height: 100vh;
            overflow: hidden;
            user-select: none;
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            grid-template-rows: 70px 1fr 50px;
            grid-template-areas: 
                "header header header"
                "sidebar main inspector"
                "footer footer footer";
            height: 100vh;
            gap: 10px;
            padding: 10px;
        }
        
        .app-header {
            grid-area: header;
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 100;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            color: white;
        }
        
        .logo-text {
            font-size: 22px;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header-controls {
            display: flex;
            gap: 12px;
        }
        
        .btn {
            padding: 10px 18px;
            border-radius: 8px;
            border: none;
            background: var(--card-bg);
            color: var(--light);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover, .btn:focus {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            outline: 2px solid rgba(255, 255, 255, 0.5);
        }
        
        .btn-primary {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .sidebar {
            grid-area: sidebar;
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        
        .panel {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 18px;
            border: 1px solid var(--border-color);
        }
        
        .panel-title {
            font-size: 18px;
            margin-bottom: 16px;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .elements-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .element-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: grab;
            transition: var(--transition);
        }
        
        .element-card:hover, .element-card:focus {
            background: rgba(79, 70, 229, 0.2);
            transform: translateY(-3px);
            outline: 2px solid var(--primary);
        }
        
        .element-icon {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--secondary);
        }
        
        .main-content {
            grid-area: main;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .canvas-toolbar {
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 12px 20px;
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .tool-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: var(--card-bg);
            border: none;
            color: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .tool-btn.active, .tool-btn:focus {
            background: var(--primary);
            color: white;
            outline: 2px solid rgba(255, 255, 255, 0.5);
        }
        
        .tool-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .canvas-container {
            flex: 1;
            background: var(--panel-bg);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        
        #stage {
            width: 100%;
            height: 100%;
            background: #1e293b;
            position: relative;
            overflow: auto;
        }
        
        .canvas-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            pointer-events: none;
        }
        
        .artboard {
            width: 1200px;
            min-height: 800px;
            background: white;
            margin: 40px auto;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .inspector {
            grid-area: inspector;
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        
        .properties-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .prop-group {
            margin-bottom: 15px;
        }
        
        .prop-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: var(--secondary);
        }
        
        .prop-input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            color: var(--light);
            font-size: 14px;
        }
        
        .prop-input:focus {
            border-color: var(--primary);
            outline: 2px solid rgba(79, 70, 229, 0.5);
        }
        
        .color-picker {
            height: 40px;
            padding: 0;
            cursor: pointer;
        }
        
        .gradient-preview {
            height: 60px;
            border-radius: 8px;
            margin-top: 10px;
            border: 1px solid var(--border-color);
        }
        
        .app-footer {
            grid-area: footer;
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
            color: var(--secondary);
        }
        
        .status-bar {
            display: flex;
            gap: 20px;
        }
        
        /* Elementos editables con mejoras de interacción */
        .editable {
            position: absolute;
            min-width: 80px;
            min-height: 50px;
            outline: none;
            box-sizing: border-box;
            touch-action: none;
            user-select: none;
            resize: none;
            cursor: move;
            transition: box-shadow 0.2s ease;
            will-change: transform;
            border: 1px dashed transparent;
        }
        
        .editable:hover, .editable:focus {
            border-color: var(--primary);
        }
        
        .selected {
            box-shadow: 0 0 0 3px var(--primary), 0 0 20px rgba(79, 70, 229, 0.3);
            z-index: 1000;
            border: 1px dashed var(--primary);
        }
        
        .components-panel {
            margin-top: 20px;
        }
        
        .components-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .component-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .component-card:hover, .component-card:focus {
            background: rgba(79, 70, 229, 0.2);
            transform: translateY(-3px);
            outline: 2px solid var(--primary);
        }
        
        .layers-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .layer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.01);
            cursor: pointer;
            transition: background 0.2s ease;
        }
        
        .layer-item.selected {
            background: rgba(79, 70, 229, 0.15);
        }
        
        .layer-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .layer-actions {
            display: flex;
            gap: 5px;
        }
        
        .layer-btn {
            background: none;
            border: none;
            color: var(--light);
            cursor: pointer;
            font-size: 12px;
            padding: 4px;
            border-radius: 4px;
        }
        
        .layer-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* MEJORAS PARA EXPERIENCIA ILLUSTRATOR */
        
        /* Transform Box */
        .transform-box {
            position: absolute;
            border: 2px solid var(--primary);
            pointer-events: none;
            z-index: 1001;
        }
        
        .transform-handle {
            position: absolute;
            width: 12px;
            height: 12px;
            background: white;
            border: 2px solid var(--primary);
            border-radius: 50%;
            cursor: pointer;
            z-index: 1002;
            pointer-events: all;
        }
        
        .transform-handle.nw {
            top: -6px;
            left: -6px;
            cursor: nw-resize;
        }
        
        .transform-handle.ne {
            top: -6px;
            right: -6px;
            cursor: ne-resize;
        }
        
        .transform-handle.sw {
            bottom: -6px;
            left: -6px;
            cursor: sw-resize;
        }
        
        .transform-handle.se {
            bottom: -6px;
            right: -6px;
            cursor: se-resize;
        }
        
        .transform-handle.n {
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            cursor: n-resize;
        }
        
        .transform-handle.s {
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            cursor: s-resize;
        }
        
        .transform-handle.w {
            top: 50%;
            left: -6px;
            transform: translateY(-50%);
            cursor: w-resize;
        }
        
        .transform-handle.e {
            top: 50%;
            right: -6px;
            transform: translateY(-50%);
            cursor: e-resize;
        }
        
        .transform-handle.rotate {
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            cursor: alias;
        }
        
        /* Zoom Controls */
        .zoom-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            background: var(--panel-bg);
            padding: 10px;
            border-radius: 8px;
            z-index: 500;
        }
        
        .zoom-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: var(--card-bg);
            border: none;
            color: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .zoom-btn:hover {
            background: var(--primary);
        }
        
        /* Rulers */
        .ruler-horizontal {
            position: absolute;
            top: 0;
            left: 0;
            height: 30px;
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            z-index: 400;
            display: flex;
            overflow: hidden;
        }
        
        .ruler-vertical {
            position: absolute;
            top: 0;
            left: 0;
            width: 30px;
            background: var(--card-bg);
            border-right: 1px solid var(--border-color);
            z-index: 400;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .ruler-unit {
            color: rgba(255, 255, 255, 0.6);
            font-size: 10px;
            text-align: center;
            flex-shrink: 0;
        }
        
        /* Guides */
        .guide {
            position: absolute;
            z-index: 350;
            background: rgba(255, 0, 0, 0.5);
        }
        
        .guide.horizontal {
            width: 100%;
            height: 1px;
            cursor: row-resize;
        }
        
        .guide.vertical {
            width: 1px;
            height: 100%;
            cursor: col-resize;
        }
        
        /* Context Menu */
        .context-menu {
            position: absolute;
            background: var(--panel-bg);
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 2000;
            display: none;
            min-width: 180px;
            overflow: hidden;
        }
        
        .context-item {
            display: block;
            width: 100%;
            padding: 10px 20px;
            text-align: left;
            background: none;
            border: none;
            color: var(--light);
            cursor: pointer;
            transition: background 0.2s;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .context-item:hover {
            background: rgba(79, 70, 229, 0.2);
        }
        
        .context-divider {
            height: 1px;
            background: var(--border-color);
            margin: 5px 0;
        }
        
        /* Selection Box */
        .selection-box {
            position: absolute;
            background: rgba(79, 70, 229, 0.15);
            border: 2px solid var(--primary);
            z-index: 999;
            display: none;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .app-container {
                grid-template-columns: 240px 1fr;
                grid-template-areas: 
                    "header header"
                    "sidebar main"
                    "inspector inspector"
                    "footer footer";
            }
            
            .inspector {
                height: 400px;
            }
            
            .properties-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "header"
                    "main"
                    "sidebar"
                    "inspector"
                    "footer";
            }
            
            .sidebar, .inspector {
                height: auto;
            }
            
            .elements-grid, .components-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .header-controls {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: var(--panel-bg);
            padding: 30px;
            border-radius: 15px;
            width: 500px;
            max-width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--light);
            font-size: 1.5rem;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .modal-body {
            margin-bottom: 20px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            background: var(--success);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            z-index: 2000;
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .element-preview {
            position: absolute;
            background: rgba(79, 70, 229, 0.2);
            border: 2px dashed var(--primary);
            border-radius: 4px;
            pointer-events: none;
            z-index: 999;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header" role="banner">
            <div class="logo">
                <div class="logo-icon" aria-hidden="true">E</div>
                <div class="logo-text">Editor HTML Pro</div>
            </div>
            
            <div class="header-controls">
                <button class="btn" id="new-project" aria-label="Nuevo proyecto">
                    <i class="fas fa-file" aria-hidden="true"></i> Nuevo
                </button>
                <button class="btn" id="open-project" aria-label="Abrir proyecto">
                    <i class="fas fa-folder-open" aria-hidden="true"></i> Abrir
                </button>
                <button class="btn btn-success" id="save-project" aria-label="Guardar proyecto">
                    <i class="fas fa-save" aria-hidden="true"></i> Guardar
                </button>
                <button class="btn btn-primary" id="export-project" aria-label="Exportar proyecto">
                    <i class="fas fa-file-export" aria-hidden="true"></i> Exportar
                </button>
            </div>
        </header>
        
        <aside class="sidebar" role="complementary">
            <section class="panel" aria-labelledby="elements-title">
                <h3 class="panel-title" id="elements-title"><i class="fas fa-shapes" aria-hidden="true"></i> Elementos</h3>
                <div class="elements-grid">
                    <div class="element-card" data-type="text" role="button" tabindex="0">
                        <div class="element-icon"><i class="fas fa-heading" aria-hidden="true"></i></div>
                        <div>Texto</div>
                    </div>
                    <div class="element-card" data-type="button" role="button" tabindex="0">
                        <div class="element-icon"><i class="fas fa-hand-pointer" aria-hidden="true"></i></div>
                        <div>Botón</div>
                    </div>
                    <div class="element-card" data-type="image" role="button" tabindex="0">
                        <div class="element-icon"><i class="fas fa-image" aria-hidden="true"></i></div>
                        <div>Imagen</div>
                    </div>
                    <div class="element-card" data-type="div" role="button" tabindex="0">
                        <div class="element-icon"><i class="fas fa-square" aria-hidden="true"></i></div>
                        <div>Contenedor</div>
                    </div>
                    <div class="element-card" data-type="form" role="button" tabindex="0">
                        <div class="element-icon"><i class="fas fa-list" aria-hidden="true"></i></div>
                        <div>Formulario</div>
                    </div>
                    <div class="element-card" data-type="icon" role="button" tabindex="0">
                        <div class="element-icon"><i class="fas fa-icons" aria-hidden="true"></i></div>
                        <div>Icono</div>
                    </div>
                </div>
            </section>
            
            <section class="panel" aria-labelledby="templates-title">
                <h3 class="panel-title" id="templates-title"><i class="fas fa-clone" aria-hidden="true"></i> Plantillas</h3>
                <div class="elements-grid">
                    <div class="element-card" data-template="home" role="button" tabindex="0">
                        <div class="element-icon"><i class="fas fa-home" aria-hidden="true"></i></div>
                        <div>Inicio</div>
                    </div>
                    <div class="element-card" data-template="blog" role="button" tabindex="0">
                        <div class="element-icon"><i class="fas fa-blog" aria-hidden="true"></i></div>
                        <div>Blog</div>
                    </div>
                    <div class="element-card" data-template="shop" role="button" tabindex="0">
                        <div class="element-icon"><i class="fas fa-shopping-cart" aria-hidden="true"></i></div>
                        <div>Tienda</div>
                    </div>
                    <div class="element-card" data-template="profile" role="button" tabindex="0">
                        <div class="element-icon"><i class="fas fa-user" aria-hidden="true"></i></div>
                        <div>Perfil</div>
                    </div>
                </div>
            </section>
            
            <section class="panel components-panel" aria-labelledby="components-title">
                <h3 class="panel-title" id="components-title"><i class="fas fa-cubes" aria-hidden="true"></i> Componentes</h3>
                <div class="components-grid">
                    <div class="component-card" data-component="navbar" role="button" tabindex="0">Navbar</div>
                    <div class="component-card" data-component="card" role="button" tabindex="0">Card</div>
                    <div class="component-card" data-component="footer" role="button" tabindex="0">Footer</div>
                    <div class="component-card" data-component="testimonial" role="button" tabindex="0">Testimonial</div>
                    <div class="component-card" data-component="pricing" role="button" tabindex="0">Precios</div>
                    <div class="component-card" data-component="cta" role="button" tabindex="0">CTA</div>
                </div>
            </section>
        </aside>
        
        <main class="main-content" role="main">
            <div class="canvas-toolbar" role="toolbar" aria-label="Herramientas de edición">
                <button class="tool-btn active" title="Seleccionar" data-tool="select" aria-pressed="true">
                    <i class="fas fa-mouse-pointer" aria-hidden="true"></i>
                    <span class="sr-only">Seleccionar</span>
                </button>
                <button class="tool-btn" title="Mover" data-tool="move" aria-pressed="false">
                    <i class="fas fa-arrows-alt" aria-hidden="true"></i>
                    <span class="sr-only">Mover</span>
                </button>
                <button class="tool-btn" title="Texto" data-tool="text" aria-pressed="false">
                    <i class="fas fa-font" aria-hidden="true"></i>
                    <span class="sr-only">Texto</span>
                </button>
                <button class="tool-btn" title="Formas" data-tool="shape" aria-pressed="false">
                    <i class="fas fa-shapes" aria-hidden="true"></i>
                    <span class="sr-only">Formas</span>
                </button>
                <button class="tool-btn" title="Imagen" data-tool="image" aria-pressed="false">
                    <i class="fas fa-image" aria-hidden="true"></i>
                    <span class="sr-only">Imagen</span>
                </button>
                <button class="tool-btn" title="Capa" data-tool="layer" aria-pressed="false">
                    <i class="fas fa-layer-group" aria-hidden="true"></i>
                    <span class="sr-only">Capa</span>
                </button>
                
                <div style="flex: 1;"></div>
                
                <button class="tool-btn" title="Deshacer" id="undo-btn" aria-label="Deshacer">
                    <i class="fas fa-undo" aria-hidden="true"></i>
                </button>
                <button class="tool-btn" title="Rehacer" id="redo-btn" aria-label="Rehacer">
                    <i class="fas fa-redo" aria-hidden="true"></i>
                </button>
                <button class="tool-btn" title="Vista previa" id="preview-btn" aria-label="Vista previa">
                    <i class="fas fa-eye" aria-hidden="true"></i>
                </button>
                <button class="tool-btn" title="Responsive" id="responsive-btn" aria-label="Modo responsive">
                    <i class="fas fa-mobile-alt" aria-hidden="true"></i>
                </button>
                <button class="tool-btn" title="Configuración" id="settings-btn" aria-label="Configuración">
                    <i class="fas fa-cog" aria-hidden="true"></i>
                </button>
            </div>
            
            <div class="canvas-container" aria-label="Área de diseño">
                <div id="stage">
                    <div class="ruler-horizontal" id="ruler-horizontal">
                        <!-- Units will be added dynamically -->
                    </div>
                    <div class="ruler-vertical" id="ruler-vertical">
                        <!-- Units will be added dynamically -->
                    </div>
                    <div class="canvas-grid"></div>
                    <div class="artboard" id="artboard" role="application">
                        <!-- Los elementos se añadirán aquí -->
                    </div>
                    <div class="zoom-controls">
                        <button class="zoom-btn" id="zoom-out" title="Zoom Out">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <button class="zoom-btn" id="zoom-reset" title="Reset Zoom">
                            <i class="fas fa-search"></i>
                        </button>
                        <button class="zoom-btn" id="zoom-in" title="Zoom In">
                            <i class="fas fa-search-plus"></i>
                        </button>
                    </div>
                </div>
            </div>
        </main>
        
        <aside class="inspector" role="complementary" aria-label="Panel de propiedades">
            <section class="panel" aria-labelledby="properties-title">
                <h3 class="panel-title" id="properties-title"><i class="fas fa-sliders-h" aria-hidden="true"></i> Propiedades</h3>
                
                <div class="prop-group">
                    <label class="prop-label" for="prop-x">Posición y tamaño</label>
                    <div class="properties-grid">
                        <input type="number" class="prop-input" id="prop-x" placeholder="X" aria-label="Posición X">
                        <input type="number" class="prop-input" id="prop-y" placeholder="Y" aria-label="Posición Y">
                        <input type="number" class="prop-input" id="prop-width" placeholder="Ancho" aria-label="Ancho">
                        <input type="number" class="prop-input" id="prop-height" placeholder="Alto" aria-label="Alto">
                    </div>
                </div>
                
                <div class="prop-group">
                    <label class="prop-label" for="prop-color">Estilo</label>
                    <div class="properties-grid">
                        <input type="color" class="prop-input color-picker" id="prop-color" value="#4f46e5" aria-label="Color de texto">
                        <input type="color" class="prop-input color-picker" id="prop-bg" value="#ffffff" aria-label="Color de fondo">
                        <select class="prop-input" id="prop-font" aria-label="Fuente">
                            <option>Fuente predeterminada</option>
                            <option>Arial</option>
                            <option>Roboto</option>
                            <option>Open Sans</option>
                        </select>
                        <input type="number" class="prop-input" id="prop-fontsize" placeholder="Tamaño" value="16" aria-label="Tamaño de fuente">
                    </div>
                </div>
                
                <div class="prop-group">
                    <label class="prop-label" for="prop-bg-type">Fondo</label>
                    <select class="prop-input" id="prop-bg-type" aria-label="Tipo de fondo">
                        <option>Color sólido</option>
                        <option>Degradado</option>
                        <option>Imagen</option>
                    </select>
                    <div class="gradient-preview" id="gradient-preview" style="background: linear-gradient(90deg, #4f46e5, #06b6d4);"></div>
                </div>
                
                <div class="prop-group">
                    <label class="prop-label" for="prop-shadow">Efectos</label>
                    <div class="properties-grid">
                        <input type="range" class="prop-input" id="prop-shadow" min="0" max="20" value="0" aria-label="Sombra">
                        <input type="number" class="prop-input" id="prop-shadow-value" placeholder="Sombra" value="0" aria-label="Valor de sombra">
                        <input type="range" class="prop-input" id="prop-opacity" min="0" max="100" value="100" aria-label="Opacidad">
                        <input type="number" class="prop-input" id="prop-opacity-value" placeholder="Opacidad" value="100" aria-label="Valor de opacidad">
                    </div>
                </div>
                
                <div class="properties-grid">
                    <button class="btn" id="apply-props" aria-label="Aplicar propiedades">
                        <i class="fas fa-check" aria-hidden="true"></i> Aplicar
                    </button>
                    <button class="btn btn-danger" id="delete-element" aria-label="Eliminar elemento seleccionado">
                        <i class="fas fa-trash" aria-hidden="true"></i> Eliminar
                    </button>
                </div>
            </section>
            
            <section class="panel" aria-labelledby="layers-title">
                <h3 class="panel-title" id="layers-title"><i class="fas fa-layer-group" aria-hidden="true"></i> Capas</h3>
                <div class="layers-list" id="layers-list" role="list">
                    <!-- Las capas se generarán dinámicamente -->
                </div>
                <div class="properties-grid" style="margin-top: 10px;">
                    <button class="btn" id="layer-up" aria-label="Subir capa">
                        <i class="fas fa-arrow-up" aria-hidden="true"></i> Subir
                    </button>
                    <button class="btn" id="layer-down" aria-label="Bajar capa">
                        <i class="fas fa-arrow-down" aria-hidden="true"></i> Bajar
                    </button>
                    <button class="btn" id="layer-group" aria-label="Agrupar capas">
                        <i class="fas fa-object-group" aria-hidden="true"></i> Agrupar
                    </button>
                    <button class="btn" id="layer-ungroup" aria-label="Desagrupar capas">
                        <i class="fas fa-object-ungroup" aria-hidden="true"></i> Desagrupar
                    </button>
                </div>
            </section>
            
            <section class="panel" aria-labelledby="export-title">
                <h3 class="panel-title" id="export-title"><i class="fas fa-download" aria-hidden="true"></i> Exportar</h3>
                <div class="properties-grid">
                    <button class="btn" id="export-html" aria-label="Exportar como HTML">
                        <i class="fab fa-html5" aria-hidden="true"></i> HTML
                    </button>
                    <button class="btn" id="export-css" aria-label="Exportar como CSS">
                        <i class="fab fa-css3" aria-hidden="true"></i> CSS
                    </button>
                    <button class="btn" id="export-png" aria-label="Exportar como PNG">
                        <i class="fas fa-image" aria-hidden="true"></i> PNG
                    </button>
                    <button class="btn" id="export-pdf" aria-label="Exportar como PDF">
                        <i class="fas fa-file-pdf" aria-hidden="true"></i> PDF
                    </button>
                </div>
            </section>
        </aside>
        
        <footer class="app-footer" role="contentinfo">
            <div>Editor HTML Pro v2.1 - Experiencia Illustrator</div>
            <div class="status-bar">
                <span id="status-mode">Modo: Edición</span>
                <span id="status-selection">Selección: Ninguna</span>
                <span id="status-position">Posición: 0x0</span>
                <span id="status-zoom">Zoom: 100%</span>
            </div>
        </footer>
    </div>

    <!-- Modal para exportación -->
    <div class="modal" id="export-modal" role="dialog" aria-modal="true" aria-labelledby="export-modal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="export-modal-title">
                    <i class="fas fa-file-export" aria-hidden="true"></i> Exportar Proyecto
                </h2>
                <button class="modal-close" id="export-cancel" aria-label="Cerrar">&times;</button>
            </div>
            <div class="modal-body">
                <div class="prop-group">
                    <label class="prop-label" for="export-filename">Nombre del archivo:</label>
                    <input type="text" id="export-filename" class="prop-input" value="mi-proyecto">
                </div>
                <div class="prop-group">
                    <label class="prop-label" for="export-format">Formato:</label>
                    <select id="export-format" class="prop-input">
                        <option value="html">HTML Completo</option>
                        <option value="html-css">HTML + CSS</option>
                        <option value="react">Componente React</option>
                        <option value="vue">Componente Vue</option>
                    </select>
                </div>
                <div class="prop-group" id="quality-control" style="display: none;">
                    <label class="prop-label" for="export-quality">Calidad:</label>
                    <input type="range" id="export-quality" class="prop-input" min="1" max="10" value="8">
                    <span id="quality-value">80%</span>
                </div>
            </div>
            <div class="modal-footer">
                <button id="export-confirm" class="btn btn-primary">
                    <i class="fas fa-download" aria-hidden="true"></i> Exportar
                </button>
                <button id="export-cancel-btn" class="btn btn-danger">
                    <i class="fas fa-times" aria-hidden="true"></i> Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Notificación flotante -->
    <div class="notification" id="notification" aria-live="polite"></div>

    <!-- Context Menu -->
    <div class="context-menu" id="context-menu">
        <button class="context-item" id="context-cut">
            <i class="fas fa-cut"></i> Cortar
        </button>
        <button class="context-item" id="context-copy">
            <i class="fas fa-copy"></i> Copiar
        </button>
        <button class="context-item" id="context-paste">
            <i class="fas fa-paste"></i> Pegar
        </button>
        <div class="context-divider"></div>
        <button class="context-item" id="context-duplicate">
            <i class="fas fa-clone"></i> Duplicar
        </button>
        <button class="context-item" id="context-group">
            <i class="fas fa-object-group"></i> Agrupar
        </button>
        <button class="context-item" id="context-ungroup">
            <i class="fas fa-object-ungroup"></i> Desagrupar
        </button>
        <div class="context-divider"></div>
        <button class="context-item" id="context-bring-forward">
            <i class="fas fa-arrow-up"></i> Traer al frente
        </button>
        <button class="context-item" id="context-send-backward">
            <i class="fas fa-arrow-down"></i> Enviar atrás
        </button>
    </div>

    <script>
        // Estado de la aplicación mejorado
        const state = {
            currentTool: 'select',
            selectedElement: null,
            elements: [],
            groups: [],
            project: {
                name: 'Proyecto sin título',
                artboard: {
                    width: 1200,
                    height: 800,
                    background: '#ffffff'
                },
                components: [],
                pages: []
            },
            history: [],
            historyIndex: -1,
            historyLimit: 50,
            zoomLevel: 100,
            dragPreview: null,
            isDragging: false,
            isRotating: false,
            isResizing: false,
            isPanning: false,
            guides: [],
            clipboard: null
        };
        
        // Referencias a elementos DOM
        const DOM = {
            artboard: document.getElementById('artboard'),
            stage: document.getElementById('stage'),
            layersList: document.getElementById('layers-list'),
            exportModal: document.getElementById('export-modal'),
            exportFormat: document.getElementById('export-format'),
            exportQuality: document.getElementById('export-quality'),
            qualityValue: document.getElementById('quality-value'),
            qualityControl: document.getElementById('quality-control'),
            notification: document.getElementById('notification'),
            contextMenu: document.getElementById('context-menu'),
            rulerHorizontal: document.getElementById('ruler-horizontal'),
            rulerVertical: document.getElementById('ruler-vertical'),
            zoomOutBtn: document.getElementById('zoom-out'),
            zoomResetBtn: document.getElementById('zoom-reset'),
            zoomInBtn: document.getElementById('zoom-in')
        };
        
        // Inicialización mejorada
        document.addEventListener('DOMContentLoaded', () => {
            initEventListeners();
            createSampleElements();
            updateStatusBar();
            showNotification('Editor listo. ¡Comienza a diseñar!', 'success');
            initRulers();
            initTransformBox();
        });
        
        // Función para mostrar notificaciones
        function showNotification(message, type = 'info') {
            DOM.notification.textContent = message;
            DOM.notification.className = 'notification show';
            DOM.notification.style.background = type === 'error' ? 
                'var(--danger)' : type === 'success' ? 
                'var(--success)' : 'var(--primary)';
            
            setTimeout(() => {
                DOM.notification.className = 'notification';
            }, 3000);
        }
        
        // Sanitización básica de HTML
        function sanitizeHTML(html) {
            const temp = document.createElement('div');
            temp.textContent = html;
            return temp.innerHTML;
        }
        
        // Delegación de eventos mejorada
        function initEventListeners() {
            // Herramientas
            document.querySelector('.canvas-toolbar').addEventListener('click', (e) => {
                const btn = e.target.closest('.tool-btn');
                if (btn) {
                    document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    state.currentTool = btn.dataset.tool;
                    document.getElementById('status-mode').textContent = `Modo: ${btn.title}`;
                }
            });
            
            // Elementos y componentes usando delegación
            document.querySelector('.sidebar').addEventListener('click', (e) => {
                const card = e.target.closest('.element-card, .component-card');
                if (card) {
                    if (card.classList.contains('element-card')) {
                        createElement(card.dataset.type);
                    } else {
                        addComponent(card.dataset.component);
                    }
                }
            });
            
            // Botones de proyecto
            document.getElementById('new-project').addEventListener('click', newProject);
            document.getElementById('save-project').addEventListener('click', saveProject);
            document.getElementById('export-project').addEventListener('click', showExportModal);
            document.getElementById('export-confirm').addEventListener('click', exportProject);
            document.getElementById('export-cancel').addEventListener('click', hideExportModal);
            document.getElementById('export-cancel-btn').addEventListener('click', hideExportModal);
            
            // Botones de capas
            document.getElementById('layer-up').addEventListener('click', moveLayerUp);
            document.getElementById('layer-down').addEventListener('click', moveLayerDown);
            document.getElementById('layer-group').addEventListener('click', groupElements);
            document.getElementById('layer-ungroup').addEventListener('click', ungroupElements);
            
            // Botones de propiedades
            document.getElementById('apply-props').addEventListener('click', applyProperties);
            document.getElementById('delete-element').addEventListener('click', deleteSelected);
            
            // Botones de exportación
            document.getElementById('export-html').addEventListener('click', () => exportFormat('html'));
            document.getElementById('export-css').addEventListener('click', () => exportFormat('css'));
            document.getElementById('export-png').addEventListener('click', () => exportFormat('png'));
            document.getElementById('export-pdf').addEventListener('click', () => exportFormat('pdf'));
            
            // Botones de historial
            document.getElementById('undo-btn').addEventListener('click', undo);
            document.getElementById('redo-btn').addEventListener('click', redo);
            
            // Botones de zoom
            DOM.zoomOutBtn.addEventListener('click', () => zoomCanvas(-0.1));
            DOM.zoomResetBtn.addEventListener('click', () => resetZoom());
            DOM.zoomInBtn.addEventListener('click', () => zoomCanvas(0.1));
            
            // Eventos de arrastre mejorados
            DOM.artboard.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', endDrag);
            
            // Eventos de entrada con validación
            document.querySelectorAll('.prop-input').forEach(input => {
                input.addEventListener('change', updateLinkedInputs);
                
                // Validación para campos numéricos
                if (input.type === 'number') {
                    input.addEventListener('input', validateNumberInput);
                }
            });
            
            // Eventos de exportación
            DOM.exportFormat.addEventListener('change', toggleQualityControl);
            DOM.exportQuality.addEventListener('input', updateQualityValue);
            
            // Soporte para teclado
            document.addEventListener('keydown', handleKeyEvents);
            
            // Eventos para panorámica (pan)
            DOM.stage.addEventListener('mousedown', startPan);
            document.addEventListener('mousemove', handlePan);
            document.addEventListener('mouseup', endPan);
            
            // Eventos para zoom con rueda
            DOM.stage.addEventListener('wheel', handleWheelZoom);
            
            // Menú contextual
            DOM.artboard.addEventListener('contextmenu', showContextMenu);
            document.addEventListener('click', hideContextMenu);
            
            // Items del menú contextual
            document.getElementById('context-cut').addEventListener('click', cutElement);
            document.getElementById('context-copy').addEventListener('click', copyElement);
            document.getElementById('context-paste').addEventListener('click', pasteElement);
            document.getElementById('context-duplicate').addEventListener('click', duplicateElement);
            document.getElementById('context-group').addEventListener('click', groupElements);
            document.getElementById('context-ungroup').addEventListener('click', ungroupElements);
            document.getElementById('context-bring-forward').addEventListener('click', moveLayerUp);
            document.getElementById('context-send-backward').addEventListener('click', moveLayerDown);
        }
        
        // =======================
        // FUNCIONES DE ILUSTRATOR
        // =======================
        
        // Inicializar reglas
        function initRulers() {
            // Limpiar reglas
            DOM.rulerHorizontal.innerHTML = '';
            DOM.rulerVertical.innerHTML = '';
            
            // Agregar unidades a la regla horizontal
            for (let i = 0; i <= 1200; i += 50) {
                const unit = document.createElement('div');
                unit.className = 'ruler-unit';
                unit.style.width = '50px';
                unit.textContent = i;
                DOM.rulerHorizontal.appendChild(unit);
            }
            
            // Agregar unidades a la regla vertical
            for (let i = 0; i <= 800; i += 50) {
                const unit = document.createElement('div');
                unit.className = 'ruler-unit';
                unit.style.height = '50px';
                unit.textContent = i;
                DOM.rulerVertical.appendChild(unit);
            }
        }
        
        // Crear caja de transformación
        function initTransformBox() {
            const box = document.createElement('div');
            box.id = 'transform-box';
            box.className = 'transform-box';
            
            // Crear manejadores
            const handles = [
                {position: 'nw', cursor: 'nw-resize'},
                {position: 'n', cursor: 'n-resize'},
                {position: 'ne', cursor: 'ne-resize'},
                {position: 'e', cursor: 'e-resize'},
                {position: 'se', cursor: 'se-resize'},
                {position: 's', cursor: 's-resize'},
                {position: 'sw', cursor: 'sw-resize'},
                {position: 'w', cursor: 'w-resize'},
                {position: 'rotate', cursor: 'alias'}
            ];
            
            handles.forEach(handle => {
                const handleEl = document.createElement('div');
                handleEl.className = `transform-handle ${handle.position}`;
                handleEl.style.cursor = handle.cursor;
                box.appendChild(handleEl);
            });
            
            document.body.appendChild(box);
            return box;
        }
        
        // Actualizar caja de transformación
        function updateTransformBox(element) {
            const box = document.getElementById('transform-box');
            if (!box) return;
            
            if (element) {
                const rect = element.getBoundingClientRect();
                const artboardRect = DOM.artboard.getBoundingClientRect();
                
                box.style.display = 'block';
                box.style.left = (rect.left - artboardRect.left + DOM.stage.scrollLeft) + 'px';
                box.style.top = (rect.top - artboardRect.top + DOM.stage.scrollTop) + 'px';
                box.style.width = rect.width + 'px';
                box.style.height = rect.height + 'px';
                
                // Agregar manejadores a los handles
                const handles = box.querySelectorAll('.transform-handle');
                handles.forEach(handle => {
                    handle.addEventListener('mousedown', (e) => {
                        e.stopPropagation();
                        handleTransform(handle.classList[1], element);
                    });
                });
            } else {
                box.style.display = 'none';
            }
        }
        
        // Manejar transformaciones
        function handleTransform(handleType, element) {
            // Implementar lógica para redimensionar y rotar
            console.log(`Transform handle: ${handleType} clicked`);
            showNotification(`Transformando elemento con manejador: ${handleType}`, 'info');
        }
        
        // Zoom en el lienzo
        function zoomCanvas(amount) {
            state.zoomLevel = Math.max(50, Math.min(200, state.zoomLevel + (amount * 100)));
            DOM.artboard.style.transform = `scale(${state.zoomLevel / 100})`;
            document.getElementById('status-zoom').textContent = `Zoom: ${state.zoomLevel}%`;
        }
        
        // Resetear zoom
        function resetZoom() {
            state.zoomLevel = 100;
            DOM.artboard.style.transform = 'scale(1)';
            document.getElementById('status-zoom').textContent = 'Zoom: 100%';
        }
        
        // Manejar zoom con rueda
        function handleWheelZoom(e) {
            if (e.ctrlKey) {
                e.preventDefault();
                const delta = e.deltaY > 0 ? -0.1 : 0.1;
                zoomCanvas(delta);
            }
        }
        
        // Funciones para panorámica (pan)
        function startPan(e) {
            if (e.button === 1 || (e.button === 0 && e.shiftKey)) {
                state.isPanning = true;
                state.panStartX = e.clientX;
                state.panStartY = e.clientY;
                state.panScrollLeft = DOM.stage.scrollLeft;
                state.panScrollTop = DOM.stage.scrollTop;
                DOM.stage.style.cursor = 'grabbing';
                e.preventDefault();
            }
        }
        
        function handlePan(e) {
            if (state.isPanning) {
                const dx = e.clientX - state.panStartX;
                const dy = e.clientY - state.panStartY;
                DOM.stage.scrollLeft = state.panScrollLeft - dx;
                DOM.stage.scrollTop = state.panScrollTop - dy;
                e.preventDefault();
            }
        }
        
        function endPan() {
            state.isPanning = false;
            DOM.stage.style.cursor = '';
        }
        
        // Menú contextual
        function showContextMenu(e) {
            e.preventDefault();
            DOM.contextMenu.style.display = 'block';
            DOM.contextMenu.style.left = e.pageX + 'px';
            DOM.contextMenu.style.top = e.pageY + 'px';
        }
        
        function hideContextMenu() {
            DOM.contextMenu.style.display = 'none';
        }
        
        // Funciones de menú contextual
        function cutElement() {
            if (state.selectedElement) {
                copyElement();
                deleteSelected();
                showNotification('Elemento cortado', 'success');
            }
            hideContextMenu();
        }
        
        function copyElement() {
            if (state.selectedElement) {
                state.clipboard = state.selectedElement.cloneNode(true);
                showNotification('Elemento copiado', 'success');
            }
            hideContextMenu();
        }
        
        function pasteElement() {
            if (state.clipboard) {
                const cloned = state.clipboard.cloneNode(true);
                // Desplazar ligeramente el elemento pegado
                const rect = cloned.getBoundingClientRect();
                cloned.style.left = (parseInt(cloned.style.left) || 0) + 20 + 'px';
                cloned.style.top = (parseInt(cloned.style.top) || 0) + 20 + 'px';
                
                DOM.artboard.appendChild(cloned);
                state.elements.push(cloned);
                selectElement(cloned);
                saveState();
                updateLayersList();
                showNotification('Elemento pegado', 'success');
            }
            hideContextMenu();
        }
        
        function duplicateElement() {
            if (state.selectedElement) {
                const cloned = state.selectedElement.cloneNode(true);
                // Desplazar ligeramente el duplicado
                cloned.style.left = (parseInt(cloned.style.left) || 0) + 20 + 'px';
                cloned.style.top = (parseInt(cloned.style.top) || 0) + 20 + 'px';
                
                DOM.artboard.appendChild(cloned);
                state.elements.push(cloned);
                selectElement(cloned);
                saveState();
                updateLayersList();
                showNotification('Elemento duplicado', 'success');
            }
            hideContextMenu();
        }
        
        // Agrupar elementos
        function groupElements() {
            // Implementar lógica de agrupación
            showNotification('Funcionalidad de agrupación activada', 'info');
        }
        
        // Desagrupar elementos
        function ungroupElements() {
            // Implementar lógica de desagrupación
            showNotification('Funcionalidad de desagrupación activada', 'info');
        }
        
        // =======================
        // FUNCIONES EXISTENTES
        // =======================
        
        // Validación de entradas numéricas
        function validateNumberInput(e) {
            const input = e.target;
            if (input.value < 0) input.value = 0;
            
            // Límites razonables para posición y tamaño
            if (input.id === 'prop-x' || input.id === 'prop-y') {
                if (input.value > 5000) input.value = 5000;
            }
            
            if (input.id === 'prop-width' || input.id === 'prop-height') {
                if (input.value > 3000) input.value = 3000;
                if (input.value < 20) input.value = 20;
            }
            
            if (input.id === 'prop-fontsize') {
                if (input.value > 200) input.value = 200;
                if (input.value < 8) input.value = 8;
            }
        }
        
        // Manejo de eventos de teclado
        function handleKeyEvents(e) {
            // Eliminar elemento con tecla Supr
            if (e.key === 'Delete' && state.selectedElement) {
                deleteSelected();
            }
            
            // Deshacer/rehacer con Ctrl+Z/Ctrl+Y
            if (e.ctrlKey) {
                if (e.key === 'z') {
                    undo();
                    e.preventDefault();
                } else if (e.key === 'y') {
                    redo();
                    e.preventDefault();
                } else if (e.key === 'c') {
                    copyElement();
                    e.preventDefault();
                } else if (e.key === 'v') {
                    pasteElement();
                    e.preventDefault();
                } else if (e.key === 'd') {
                    duplicateElement();
                    e.preventDefault();
                } else if (e.key === 'g') {
                    groupElements();
                    e.preventDefault();
                } else if (e.key === 'Shift' && e.key === 'g') {
                    ungroupElements();
                    e.preventDefault();
                }
            }
            
            // Zoom con teclas
            if (e.key === '+' || e.key === '=') {
                zoomCanvas(0.1);
                e.preventDefault();
            } else if (e.key === '-') {
                zoomCanvas(-0.1);
                e.preventDefault();
            } else if (e.key === '0') {
                resetZoom();
                e.preventDefault();
            }
            
            // Espacio para panorámica
            if (e.key === ' ') {
                DOM.stage.style.cursor = 'grab';
            }
        }
        
        function handleMouseMove(e) {
            if (state.isDragging) {
                dragElement(e);
            } else if (state.isPanning) {
                handlePan(e);
            }
        }
        
        // Función para crear elementos de muestra con manejo de errores
        function createSampleElements() {
            try {
                // Crear navbar
                addComponent('navbar');
                
                // Crear título
                createElement('text', {
                    content: '<h1>Bienvenido a Editor HTML Pro</h1><p>Crea diseños increíbles con nuestra herramienta</p>',
                    x: 200,
                    y: 150,
                    width: 800,
                    height: 150
                });
                
                // Crear card
                addComponent('card', {
                    x: 200,
                    y: 350
                });
                
                // Crear footer
                addComponent('footer', {
                    y: 700
                });
            } catch (error) {
                console.error('Error al crear elementos de muestra:', error);
                showNotification('Error al crear elementos de muestra', 'error');
            }
        }
        
        // Función para nuevo proyecto con confirmación mejorada
        function newProject() {
            try {
                if (confirm('¿Estás seguro de que quieres crear un nuevo proyecto?\nSe perderán los cambios no guardados.')) {
                    DOM.artboard.innerHTML = '';
                    state.elements = [];
                    state.history = [];
                    state.historyIndex = -1;
                    state.selectedElement = null;
                    updateLayersList();
                    updateStatusBar();
                    updateTransformBox(null);
                    showNotification('Nuevo proyecto creado', 'success');
                }
            } catch (error) {
                console.error('Error al crear nuevo proyecto:', error);
                showNotification('Error al crear nuevo proyecto', 'error');
            }
        }
        
        // Función para guardar proyecto con validación
        function saveProject() {
            try {
                if (state.elements.length === 0) {
                    showNotification('No hay elementos para guardar', 'error');
                    return;
                }
                
                state.project.components = state.elements.map(el => {
                    return {
                        type: el.dataset.type || 'custom',
                        x: parseInt(el.style.left) || 0,
                        y: parseInt(el.style.top) || 0,
                        width: parseInt(el.style.width) || 0,
                        height: parseInt(el.style.height) || 0,
                        content: sanitizeHTML(el.innerHTML),
                        styles: el.style.cssText
                    };
                });
                
                // Simular guardado
                const data = JSON.stringify(state.project, null, 2);
                const blob = new Blob([data], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `${state.project.name.replace(/\s+/g, '-').toLowerCase()}.htmlpro`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                showNotification(`Proyecto "${state.project.name}" guardado con éxito!`, 'success');
            } catch (error) {
                console.error('Error al guardar proyecto:', error);
                showNotification('Error al guardar proyecto', 'error');
            }
        }
        
        // Funciones para mostrar/ocultar modal de exportación
        function showExportModal() {
            DOM.exportModal.style.display = 'flex';
            document.getElementById('export-filename').focus();
        }
        
        function hideExportModal() {
            DOM.exportModal.style.display = 'none';
        }
        
        function toggleQualityControl() {
            const format = DOM.exportFormat.value;
            DOM.qualityControl.style.display = (format === 'png' || format === 'pdf') ? 'block' : 'none';
        }
        
        function updateQualityValue() {
            DOM.qualityValue.textContent = `${DOM.exportQuality.value * 10}%`;
        }
        
        // Función para exportar proyecto con validación
        function exportProject() {
            try {
                const filename = document.getElementById('export-filename').value.trim();
                if (!filename) {
                    showNotification('El nombre del archivo no puede estar vacío', 'error');
                    return;
                }
                
                const format = DOM.exportFormat.value;
                hideExportModal();
                showNotification(`Exportando proyecto como ${filename}.${format}...`, 'info');
                
                // Implementación real de exportación iría aquí
                setTimeout(() => {
                    showNotification(`Proyecto exportado como ${filename}.${format}`, 'success');
                }, 2000);
            } catch (error) {
                console.error('Error al exportar proyecto:', error);
                showNotification('Error al exportar proyecto', 'error');
            }
        }
        
        // Función para exportar por formato
        function exportFormat(format) {
            if (state.elements.length === 0) {
                showNotification('No hay elementos para exportar', 'error');
                return;
            }
            
            showNotification(`Exportando como ${format.toUpperCase()}...`, 'info');
            
            // Implementación real de exportación por formato iría aquí
            setTimeout(() => {
                showNotification(`Exportación ${format.toUpperCase()} completada`, 'success');
            }, 1500);
        }
        
        // Función para crear elementos con sanitización
        function createElement(type, options = {}) {
            try {
                const element = document.createElement('div');
                element.className = 'editable';
                element.dataset.type = type;
                element.tabIndex = 0;
                element.setAttribute('aria-label', `Elemento ${type}`);
                element.innerHTML = getElementContent(type, options);
                
                // Posicionamiento
                element.style.position = 'absolute';
                element.style.left = (options.x || 50) + 'px';
                element.style.top = (options.y || 50) + 'px';
                element.style.width = (options.width || 200) + 'px';
                element.style.height = (options.height || (type === 'text' ? 'auto' : '100px'));
                
                // Hacer seleccionable
                element.addEventListener('click', function(e) {
                    e.stopPropagation();
                    selectElement(this);
                });
                
                // Soporte para foco con teclado
                element.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        selectElement(element);
                    }
                });
                
                DOM.artboard.appendChild(element);
                state.elements.push(element);
                
                // Guardar en historial
                saveState();
                selectElement(element);
                updateLayersList();
                showNotification(`Elemento ${type} creado`, 'success');
                
                return element;
            } catch (error) {
                console.error('Error al crear elemento:', error);
                showNotification('Error al crear elemento', 'error');
                return null;
            }
        }
        
        // Función para obtener contenido de elementos con sanitización
        function getElementContent(type, options = {}) {
            let content = '';
            
            switch(type) {
                case 'text':
                    content = options.content || '<h2 style="margin:0">Título de ejemplo</h2><p style="margin:10px 0 0">Este es un párrafo de texto. Haz clic para editar.</p>';
                    break;
                case 'button':
                    content = '<button style="width:100%;height:100%;background:#4f46e5;color:white;border:none;border-radius:8px;font-size:16px;cursor:pointer;">Botón</button>';
                    break;
                case 'image':
                    content = '<div style="width:100%;height:100%;background:#e2e8f0;border-radius:8px;display:flex;align-items:center;justify-content:center;overflow:hidden;"><div style="text-align:center;color:#64748b;"><i class="fas fa-image fa-3x"></i><p>Haz clic para añadir una imagen</p></div></div>';
                    break;
                case 'form':
                    content = '<div style="padding:15px;"><input type="text" placeholder="Nombre" style="width:100%;padding:8px;margin-bottom:10px;"><input type="email" placeholder="Email" style="width:100%;padding:8px;margin-bottom:10px;"><button style="background:#4f46e5;color:white;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;">Enviar</button></div>';
                    break;
                case 'icon':
                    content = '<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:32px;"><i class="fas fa-star"></i></div>';
                    break;
                default:
                    content = type;
            }
            
            return sanitizeHTML(content);
        }
        
        // Función para añadir componentes
        function addComponent(name, options = {}) {
            try {
                const element = document.createElement('div');
                element.className = 'editable';
                element.dataset.type = 'component';
                element.dataset.component = name;
                element.tabIndex = 0;
                element.setAttribute('aria-label', `Componente ${name}`);
                
                switch(name) {
                    case 'navbar':
                        element.innerHTML = sanitizeHTML(`
                            <div style="display:flex; justify-content:space-between; align-items:center; padding:15px; background:#1e293b; color:white;">
                                <div style="font-weight:bold; font-size:20px;">Logo</div>
                                <div>
                                    <a href="#" style="color:white; margin:0 10px; text-decoration:none;">Inicio</a>
                                    <a href="#" style="color:white; margin:0 10px; text-decoration:none;">Productos</a>
                                    <a href="#" style="color:white; margin:0 10px; text-decoration:none;">Contacto</a>
                                </div>
                            </div>
                        `);
                        element.style.width = '100%';
                        element.style.height = '60px';
                        element.style.position = 'relative';
                        element.style.top = '0';
                        element.style.left = '0';
                        break;
                        
                    case 'card':
                        element.innerHTML = sanitizeHTML(`
                            <div style="border-radius:10px; overflow:hidden; box-shadow:0 4px 10px rgba(0,0,0,0.1); background:white;">
                                <div style="height:150px; background:#e2e8f0; display:flex; align-items:center; justify-content:center;">
                                    <i class="fas fa-image fa-3x" style="color:#64748b;"></i>
                                </div>
                                <div style="padding:20px;">
                                    <h3 style="margin:0 0 10px;">Título de la tarjeta</h3>
                                    <p style="margin:0 0 15px; color:#64748b;">Descripción de la tarjeta con texto de ejemplo.</p>
                                    <button style="background:#4f46e5; color:white; border:none; padding:8px 16px; border-radius:4px; cursor:pointer;">Ver más</button>
                                </div>
                            </div>
                        `);
                        element.style.width = '300px';
                        element.style.height = 'auto';
                        element.style.left = (options.x || 200) + 'px';
                        element.style.top = (options.y || 150) + 'px';
                        break;
                        
                    case 'footer':
                        element.innerHTML = sanitizeHTML(`
                            <div style="background:#1e293b; color:white; padding:30px; text-align:center; width:100%;">
                                <div style="margin-bottom:20px;">
                                    <a href="#" style="color:white; margin:0 10px; text-decoration:none;">Inicio</a>
                                    <a href="#" style="color:white; margin:0 10px; text-decoration:none;">Acerca de</a>
                                    <a href="#" style="color:white; margin:0 10px; text-decoration:none;">Contacto</a>
                                </div>
                                <div>© ${new Date().getFullYear()} Mi Sitio Web. Todos los derechos reservados.</div>
                            </div>
                        `);
                        element.style.width = '100%';
                        element.style.height = 'auto';
                        element.style.position = 'absolute';
                        element.style.bottom = '0';
                        element.style.left = '0';
                        element.style.top = (options.y || 700) + 'px';
                        break;
                        
                    default:
                        element.innerHTML = sanitizeHTML(`<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;">${name}</div>`);
                }
                
                DOM.artboard.appendChild(element);
                
                // Hacer seleccionable
                element.addEventListener('click', function(e) {
                    e.stopPropagation();
                    selectElement(this);
                });
                
                // Soporte para foco con teclado
                element.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        selectElement(element);
                    }
                });
                
                state.elements.push(element);
                selectElement(element);
                saveState();
                updateLayersList();
                showNotification(`Componente ${name} añadido`, 'success');
            } catch (error) {
                console.error('Error al añadir componente:', error);
                showNotification('Error al añadir componente', 'error');
            }
        }
        
        // Función para seleccionar elementos
        function selectElement(element) {
            try {
                // Deseleccionar elemento actual
                if (state.selectedElement) {
                    state.selectedElement.classList.remove('selected');
                    state.selectedElement.removeAttribute('aria-selected');
                }
                
                // Seleccionar nuevo elemento
                state.selectedElement = element;
                element.classList.add('selected');
                element.setAttribute('aria-selected', 'true');
                element.focus();
                
                // Actualizar propiedades en el inspector
                updateInspector();
                updateStatusBar();
                updateTransformBox(element);
            } catch (error) {
                console.error('Error al seleccionar elemento:', error);
            }
        }
        
        // Función para actualizar inspector
        function updateInspector() {
            if (!state.selectedElement) return;
            
            const el = state.selectedElement;
            
            // Actualizar posición y tamaño
            document.getElementById('prop-x').value = parseInt(el.style.left) || 0;
            document.getElementById('prop-y').value = parseInt(el.style.top) || 0;
            document.getElementById('prop-width').value = parseInt(el.style.width) || 0;
            document.getElementById('prop-height').value = parseInt(el.style.height) || 0;
            
            // Actualizar estilos
            document.getElementById('prop-color').value = getComputedStyle(el).color;
            document.getElementById('prop-bg').value = getComputedStyle(el).backgroundColor;
            document.getElementById('prop-fontsize').value = parseInt(getComputedStyle(el).fontSize) || 16;
            
            // Actualizar estado
            document.getElementById('status-selection').textContent = `Selección: ${el.dataset.type || 'Elemento'}`;
        }
        
        // Función para aplicar propiedades
        function applyProperties() {
            if (!state.selectedElement) {
                showNotification('No hay elemento seleccionado', 'error');
                return;
            }
            
            const el = state.selectedElement;
            
            // Aplicar posición y tamaño
            el.style.left = document.getElementById('prop-x').value + 'px';
            el.style.top = document.getElementById('prop-y').value + 'px';
            el.style.width = document.getElementById('prop-width').value + 'px';
            el.style.height = document.getElementById('prop-height').value + 'px';
            
            // Aplicar estilos
            el.style.color = document.getElementById('prop-color').value;
            el.style.backgroundColor = document.getElementById('prop-bg').value;
            el.style.fontSize = document.getElementById('prop-fontsize').value + 'px';
            
            saveState();
            updateStatusBar();
            showNotification('Propiedades aplicadas', 'success');
        }
        
        // Función para eliminar elemento seleccionado
        function deleteSelected() {
            if (!state.selectedElement) {
                showNotification('No hay elemento seleccionado', 'error');
                return;
            }
            
            const elementType = state.selectedElement.dataset.type || 'elemento';
            const index = state.elements.indexOf(state.selectedElement);
            if (index > -1) {
                state.elements.splice(index, 1);
            }
            
            state.selectedElement.remove();
            state.selectedElement = null;
            document.getElementById('status-selection').textContent = 'Selección: Ninguna';
            saveState();
            updateLayersList();
            updateTransformBox(null);
            showNotification(`${elementType} eliminado`, 'success');
        }
        
        // Función para actualizar lista de capas
        function updateLayersList() {
            DOM.layersList.innerHTML = '';
            
            state.elements.forEach((el, index) => {
                const layerItem = document.createElement('div');
                layerItem.className = 'layer-item';
                layerItem.setAttribute('role', 'listitem');
                
                if (el === state.selectedElement) {
                    layerItem.classList.add('selected');
                    layerItem.setAttribute('aria-current', 'true');
                }
                
                const layerType = el.dataset.type || 'elemento';
                const layerName = el.dataset.component ? el.dataset.component : layerType;
                
                layerItem.innerHTML = `
                    <div>
                        <i class="fas fa-layer-group" aria-hidden="true"></i> 
                        ${layerName.charAt(0).toUpperCase() + layerName.slice(1)} ${index + 1}
                    </div>
                    <div class="layer-actions">
                        <button class="layer-btn" data-action="select" title="Seleccionar" aria-label="Seleccionar capa">
                            <i class="fas fa-mouse-pointer" aria-hidden="true"></i>
                        </button>
                        <button class="layer-btn" data-action="delete" title="Eliminar" aria-label="Eliminar capa">
                            <i class="fas fa-trash" aria-hidden="true"></i>
                        </button>
                    </div>
                `;
                
                layerItem.querySelector('[data-action="select"]').addEventListener('click', () => {
                    selectElement(el);
                });
                
                layerItem.querySelector('[data-action="delete"]').addEventListener('click', () => {
                    const index = state.elements.indexOf(el);
                    if (index > -1) {
                        state.elements.splice(index, 1);
                    }
                    el.remove();
                    if (state.selectedElement === el) {
                        state.selectedElement = null;
                        document.getElementById('status-selection').textContent = 'Selección: Ninguna';
                        updateTransformBox(null);
                    }
                    saveState();
                    updateLayersList();
                    showNotification('Capa eliminada', 'success');
                });
                
                DOM.layersList.appendChild(layerItem);
            });
        }
        
        // Funciones para mover capas
        function moveLayerUp() {
            if (!state.selectedElement) {
                showNotification('No hay elemento seleccionado', 'error');
                return;
            }
            
            const index = state.elements.indexOf(state.selectedElement);
            if (index < state.elements.length - 1) {
                [state.elements[index], state.elements[index + 1]] = [state.elements[index + 1], state.elements[index]];
                DOM.artboard.insertBefore(state.selectedElement, state.elements[index]);
                saveState();
                updateLayersList();
                showNotification('Capa movida hacia arriba', 'success');
            }
        }
        
        function moveLayerDown() {
            if (!state.selectedElement) {
                showNotification('No hay elemento seleccionado', 'error');
                return;
            }
            
            const index = state.elements.indexOf(state.selectedElement);
            if (index > 0) {
                [state.elements[index], state.elements[index - 1]] = [state.elements[index - 1], state.elements[index]];
                if (index === state.elements.length - 1) {
                    DOM.artboard.appendChild(state.selectedElement);
                } else {
                    DOM.artboard.insertBefore(state.selectedElement, state.elements[index + 1]);
                }
                saveState();
                updateLayersList();
                showNotification('Capa movida hacia abajo', 'success');
            }
        }
        
        // Funciones para guardar estado y manejar historial
        function saveState() {
            const artboard = DOM.artboard;
            const html = artboard.innerHTML;
            
            // Limitar el tamaño del historial
            if (state.history.length >= state.historyLimit) {
                state.history.shift();
            }
            
            // Guardar en el historial
            state.history = state.history.slice(0, state.historyIndex + 1);
            state.history.push(html);
            state.historyIndex = state.history.length - 1;
        }
        
        function undo() {
            if (state.historyIndex > 0) {
                state.historyIndex--;
                DOM.artboard.innerHTML = state.history[state.historyIndex];
                
                // Actualizar elementos
                state.elements = Array.from(DOM.artboard.querySelectorAll('.editable'));
                if (state.selectedElement && !DOM.artboard.contains(state.selectedElement)) {
                    state.selectedElement = null;
                    updateTransformBox(null);
                }
                
                updateLayersList();
                updateStatusBar();
                showNotification('Acción deshecha', 'info');
            }
        }
        
        function redo() {
            if (state.historyIndex < state.history.length - 1) {
                state.historyIndex++;
                DOM.artboard.innerHTML = state.history[state.historyIndex];
                
                // Actualizar elementos
                state.elements = Array.from(DOM.artboard.querySelectorAll('.editable'));
                if (state.selectedElement && !DOM.artboard.contains(state.selectedElement)) {
                    state.selectedElement = null;
                    updateTransformBox(null);
                }
                
                updateLayersList();
                updateStatusBar();
                showNotification('Acción rehecha', 'info');
            }
        }
        
        // Funcionalidad de arrastre mejorada
        let startX, startY, startLeft, startTop;
        
        function startDrag(e) {
            if (e.target.classList.contains('editable') && state.currentTool === 'select') {
                state.isDragging = true;
                state.currentDragElement = e.target;
                startX = e.clientX;
                startY = e.clientY;
                startLeft = parseInt(state.currentDragElement.style.left) || 0;
                startTop = parseInt(state.currentDragElement.style.top) || 0;
                
                // Crear previsualización
                state.dragPreview = document.createElement('div');
                state.dragPreview.className = 'element-preview';
                state.dragPreview.style.width = state.currentDragElement.offsetWidth + 'px';
                state.dragPreview.style.height = state.currentDragElement.offsetHeight + 'px';
                state.dragPreview.style.left = startLeft + 'px';
                state.dragPreview.style.top = startTop + 'px';
                DOM.artboard.appendChild(state.dragPreview);
                
                selectElement(state.currentDragElement);
                e.preventDefault();
            }
        }
        
        function dragElement(e) {
            if (state.isDragging && state.currentDragElement && state.dragPreview) {
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                
                // Actualizar previsualización
                state.dragPreview.style.left = (startLeft + dx) + 'px';
                state.dragPreview.style.top = (startTop + dy) + 'px';
                
                e.preventDefault();
            }
        }
        
        function endDrag() {
            if (state.isDragging && state.currentDragElement && state.dragPreview) {
                // Aplicar posición final
                const finalLeft = parseInt(state.dragPreview.style.left);
                const finalTop = parseInt(state.dragPreview.style.top);
                
                state.currentDragElement.style.left = finalLeft + 'px';
                state.currentDragElement.style.top = finalTop + 'px';
                
                // Eliminar previsualización
                state.dragPreview.remove();
                state.dragPreview = null;
                
                // Actualizar UI
                updateInspector();
                updateStatusBar();
                saveState();
                
                state.isDragging = false;
                state.currentDragElement = null;
            }
        }
        
        // Función para actualizar inputs vinculados
        function updateLinkedInputs(e) {
            const input = e.target;
            
            if (input.id === 'prop-shadow') {
                document.getElementById('prop-shadow-value').value = input.value;
            } else if (input.id === 'prop-shadow-value') {
                document.getElementById('prop-shadow').value = input.value;
            } else if (input.id === 'prop-opacity') {
                document.getElementById('prop-opacity-value').value = input.value;
            } else if (input.id === 'prop-opacity-value') {
                document.getElementById('prop-opacity').value = input.value;
            }
        }
        
        // Función para actualizar barra de estado
        function updateStatusBar() {
            if (state.selectedElement) {
                const x = parseInt(state.selectedElement.style.left) || 0;
                const y = parseInt(state.selectedElement.style.top) || 0;
                document.getElementById('status-position').textContent = `Posición: ${x}x${y}`;
            }
        }
    </script>
</body>
</html>
